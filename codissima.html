<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Student Support — Frontend Only</title>
<style>
  :root{--accent:#2b7cff;--muted:#666}
  *{box-sizing:border-box}
  body{margin:0;display:flex;font-family:Inter,Arial,Helvetica,sans-serif;height:100vh;background:#f4f6fb}
  .sidebar{width:240px;background:#12141a;color:white;padding:20px}
  .sidebar h2{margin:0 0 12px 0;font-size:20px}
  .nav a{display:block;color:#dfe6ff;padding:8px;border-radius:6px;text-decoration:none;cursor:pointer;margin-bottom:6px}
  .nav a:hover{background:#1f2430}
  .content{flex:1;padding:20px;overflow:auto}
  .page{display:none}
  .page.active{display:block}
  .card{background:white;border-radius:8px;padding:12px;margin-bottom:12px;box-shadow:0 1px 3px rgba(20,20,30,0.06)}
  input,textarea,select{width:100%;padding:8px;border-radius:6px;border:1px solid #ddd;margin-top:8px;resize:vertical}
  button{background:var(--accent);color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;margin-top:8px}
  .small{font-size:12px;color:var(--muted)}
  .row{display:flex;gap:12px}
  .row > *{flex:1}
  .list-item{padding:8px;border-radius:6px;border:1px dashed #eee;margin-bottom:8px;background:#fff}
  .muted{color:var(--muted);font-size:12px}
  .ai-box{background:#f1f8ff;padding:10px;border-radius:6px;margin-top:8px;border:1px solid #e0efff}
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  @media(max-width:800px){body{flex-direction:column}.sidebar{width:100%;height:auto}.content{height:calc(100vh - 160px)}}
</style>
</head>
<body>

<div class="sidebar">
  <h2>Student Support</h2>
  <div class="nav">
    <a onclick="show('dashboard')">Dashboard</a>
    <a onclick="show('doubts')">Doubt Forum</a>
    <a onclick="show('resources')">Resources</a>
    <a onclick="show('counseling')">Counseling</a>
    <a onclick="show('announcements')">Announcements</a>
    <a onclick="show('feedback')">Feedback</a>
    <a onclick="show('settings')">Settings</a>
  </div>
</div>

<div class="content">
  <div class="topbar">
    <div><strong>Next-Gen Student Support — Frontend Only</strong></div>
    <div class="muted">Local demo • data saved in browser</div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="page active">
    <div class="card">
      <h3>Welcome</h3>
      <p class="muted">This is a working demo that runs entirely in your browser. Use the left menu to try features.</p>
    </div>

    <div id="summary" class="card">
      <!-- autogenerated summary -->
    </div>

    <div class="card">
      <h4>Quick Actions</h4>
      <div class="row">
        <button onclick="show('doubts')">Ask a doubt</button>
        <button onclick="show('resources')">Add resource</button>
        <button onclick="show('announcements')">Post announcement</button>
      </div>
    </div>
  </div>

  <!-- Doubts -->
  <div id="doubts" class="page">
    <div class="card">
      <h3>Doubt Forum</h3>
      <textarea id="doubtText" rows="3" placeholder="Write your doubt or question..."></textarea>
      <div class="row">
        <button onclick="postDoubt()">Post Doubt</button>
        <button onclick="clearDoubtInput()" style="background:#6c757d">Clear</button>
      </div>
      <p class="small">When you post a doubt you can click "AI Suggest" to get a client-side suggestion based on matching saved resources and simple templates.</p>
    </div>

    <div id="doubtList"></div>
  </div>

  <!-- Resources -->
  <div id="resources" class="page">
    <div class="card">
      <h3>Resources Hub</h3>
      <input id="resTitle" placeholder="Resource title (e.g., 'Pointers in C')">
      <input id="resLink" placeholder="Optional link (URL)">
      <textarea id="resNotes" rows="3" placeholder="Notes / short description"></textarea>
      <div class="row">
        <button onclick="addResource()">Add Resource</button>
        <button onclick="importSampleResources()" style="background:#6c757d">Import Sample</button>
      </div>
    </div>

    <div id="resourceList"></div>
  </div>

  <!-- Counseling -->
  <div id="counseling" class="page">
    <div class="card">
      <h3>Counseling Requests</h3>
      <textarea id="counselText" rows="3" placeholder="Briefly describe what you need help with (academic/personal)"></textarea>
      <div class="row">
        <button onclick="sendCounsel()">Request Counseling</button>
        <button onclick="clearCounsel()" style="background:#6c757d">Clear</button>
      </div>
    </div>

    <div id="counselList"></div>
  </div>

  <!-- Announcements -->
  <div id="announcements" class="page">
    <div class="card">
      <h3>Announcements</h3>
      <input id="annText" placeholder="Announcement text">
      <div class="row">
        <button onclick="postAnn()">Post Announcement</button>
        <button onclick="clearAnn()" style="background:#6c757d">Clear</button>
      </div>
    </div>

    <div id="annList"></div>
  </div>

  <!-- Feedback -->
  <div id="feedback" class="page">
    <div class="card">
      <h3>Feedback & Issues</h3>
      <textarea id="fbText" rows="3" placeholder="Describe issue or suggestion"></textarea>
      <div class="row">
        <button onclick="sendFB()">Send Feedback</button>
        <button onclick="clearFB()" style="background:#6c757d">Clear</button>
      </div>
    </div>

    <div id="fbList"></div>
  </div>

  <!-- Settings -->
  <div id="settings" class="page">
    <div class="card">
      <h3>Settings</h3>
      <p class="small">This demo stores data in the browser using <code>localStorage</code>. You can clear all demo data below.</p>
      <div class="row">
        <button onclick="downloadData()">Download Data (JSON)</button>
        <button onclick="clearAll()" style="background:#d9534f">Clear All Data</button>
      </div>
    </div>
    <div class="card small">
      <strong>How the AI helper works (client-side):</strong>
      <p class="small">When you click "AI Suggest", the script searches saved resources for matching keywords, then builds a short templated answer. It's a heuristic demo — not a real LLM.</p>
    </div>
  </div>

</div>

<script>
/* ---------- Simple localStorage-based datastore ---------- */
const STORE_KEYS = {
  doubts: 'ss_doubts_v1',
  resources: 'ss_resources_v1',
  counsel: 'ss_counsel_v1',
  announcements: 'ss_ann_v1',
  feedback: 'ss_fb_v1'
};

function read(key){
  const raw = localStorage.getItem(key) || '[]';
  try { return JSON.parse(raw); } catch(e) { return []; }
}
function write(key,val){ localStorage.setItem(key, JSON.stringify(val)); }

/* ---------- UI helpers ---------- */
function show(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  // refresh current page view
  renderAll();
}

function uid(){ return 'id_'+Math.random().toString(36).slice(2,9); }
function now(){ return new Date().toISOString(); }

/* ---------- Summary ---------- */
function renderSummary(){
  const s = `
    <h4>Summary</h4>
    <div class="row">
      <div class="card">
        <p><strong>Doubts:</strong> ${read(STORE_KEYS.doubts).length}</p>
        <p><strong>Resources:</strong> ${read(STORE_KEYS.resources).length}</p>
      </div>
      <div class="card">
        <p><strong>Announcements:</strong> ${read(STORE_KEYS.announcements).length}</p>
        <p><strong>Feedback:</strong> ${read(STORE_KEYS.feedback).length}</p>
      </div>
    </div>`;
  document.getElementById('summary').innerHTML = s;
}

/* ---------- Doubts ---------- */
function postDoubt(){
  const txt = document.getElementById('doubtText').value.trim();
  if(!txt){ alert('Type a doubt first'); return; }
  const arr = read(STORE_KEYS.doubts);
  arr.unshift({ id:uid(), text:txt, time:now(), answers:[] });
  write(STORE_KEYS.doubts, arr);
  document.getElementById('doubtText').value = '';
  renderDoubts();
}

function clearDoubtInput(){ document.getElementById('doubtText').value = ''; }

function deleteDoubt(id){
  let arr = read(STORE_KEYS.doubts).filter(x=>x.id!==id);
  write(STORE_KEYS.doubts, arr);
  renderDoubts();
}

function addAnswerToDoubt(doubtId, answerText){
  const arr = read(STORE_KEYS.doubts).map(d=>{
    if(d.id===doubtId){
      d.answers = d.answers || [];
      d.answers.push({ id:uid(), text:answerText, time:now() });
    }
    return d;
  });
  write(STORE_KEYS.doubts, arr);
  renderDoubts();
}

/* ---------- AI helper (client-side heuristic) ---------- */
function aiSuggestFor(text){
  // 1) find keywords (simple split)
  const words = text.toLowerCase().match(/\b[a-z0-9]+\b/g) || [];
  const resources = read(STORE_KEYS.resources);
  // 2) score resources by keyword overlap (title + notes)
  const scored = resources.map(r=>{
    const hay = ((r.title||'')+' '+(r.notes||'')).toLowerCase();
    const score = words.reduce((s,w)=> s + (hay.includes(w) ? 1 : 0), 0);
    return {...r, score};
  }).filter(r=>r.score>0).sort((a,b)=>b.score-a.score);
  // 3) build a templated reply
  let reply = '';
  if(scored.length){
    reply += 'Suggested steps based on saved resources:\n';
    scored.slice(0,3).forEach((r,i)=>{
      reply += `${i+1}. ${r.title}${r.link?(' — ' + r.link):''}\n`;
      if(r.notes) reply += `   Note: ${r.notes}\n`;
    });
    reply += '\nIf this does not solve it, try to explain the specific line or concept you are stuck on.';
  } else {
    // fallback template — give a short guidance checklist
    reply = `Try these steps:\n1) Re-state the problem in one sentence.\n2) Break it into smaller parts.\n3) Search resources (lecture notes, examples).\n4) Post code or exact error for targeted help.`;
  }
  return reply;
}

function handleAISuggest(doubtId){
  const doubts = read(STORE_KEYS.doubts);
  const d = doubts.find(x=>x.id===doubtId);
  if(!d) return;
  const suggestion = aiSuggestFor(d.text);
  addAnswerToDoubt(doubtId, suggestion);
  // show a small flash
  alert('AI suggestion added to the doubt (client-side heuristic).');
}

/* ---------- Render doubts ---------- */
function renderDoubts(){
  const container = document.getElementById('doubtList');
  const arr = read(STORE_KEYS.doubts);
  if(!arr.length){ container.innerHTML = '<div class="card">No doubts yet.</div>'; return; }
  container.innerHTML = arr.map(d=>{
    const answersHtml = (d.answers||[]).map(a=>`<div class="ai-box"><div class="small">Answer — ${new Date(a.time).toLocaleString()}</div><div style="white-space:pre-wrap;margin-top:6px">${escapeHtml(a.text)}</div></div>`).join('');
    return `
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>${escapeHtml(shorten(d.text,80))}</strong><div class="muted">${new Date(d.time).toLocaleString()}</div></div>
          <div style="display:flex;gap:8px">
            <button onclick="handleAISuggest('${d.id}')">AI Suggest</button>
            <button onclick="promptManualAnswer('${d.id}')" style="background:#6c757d">Add Answer</button>
            <button onclick="deleteDoubt('${d.id}')" style="background:#d9534f">Delete</button>
          </div>
        </div>
        <div style="margin-top:8px"><em>${escapeHtml(d.text)}</em></div>
        ${answersHtml}
      </div>
    `;
  }).join('');
}

/* ---------- Resources ---------- */
function addResource(){
  const title = document.getElementById('resTitle').value.trim();
  const link  = document.getElementById('resLink').value.trim();
  const notes = document.getElementById('resNotes').value.trim();
  if(!title) return alert('Enter a title for the resource');
  const arr = read(STORE_KEYS.resources);
  arr.unshift({ id:uid(), title, link, notes, time:now() });
  write(STORE_KEYS.resources, arr);
  document.getElementById('resTitle').value='';
  document.getElementById('resLink').value='';
  document.getElementById('resNotes').value='';
  renderResources();
}

function importSampleResources(){
  const sample = [
    { id:uid(), title:'Pointers in C — quick guide', link:'', notes:'Pointer basics, dereferencing, pointer arithmetic', time:now() },
    { id:uid(), title:'OOP Concepts — Summary', link:'', notes:'Classes, inheritance, polymorphism explained with examples', time:now() },
    { id:uid(), title:'Data Structures: Linked List', link:'', notes:'How to implement singly linked list and common operations', time:now() }
  ];
  const arr = read(STORE_KEYS.resources);
  write(STORE_KEYS.resources, sample.concat(arr));
  renderResources();
}

function deleteResource(id){
  const arr = read(STORE_KEYS.resources).filter(r=>r.id!==id);
  write(STORE_KEYS.resources, arr);
  renderResources();
}

function renderResources(){
  const arr = read(STORE_KEYS.resources);
  const out = arr.length ? arr.map(r=>`
    <div class="list-item">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <strong>${escapeHtml(r.title)}</strong>
          <div class="muted">${r.link?('<a href="'+escapeAttr(r.link)+'" target="_blank">Open link</a>') : ''}</div>
        </div>
        <div style="display:flex;gap:8px">
          <button onclick="useAsAnswer('${r.id}')">Use</button>
          <button onclick="deleteResource('${r.id}')" style="background:#d9534f">Delete</button>
        </div>
      </div>
      ${r.notes?('<div style="margin-top:8px;white-space:pre-wrap">'+escapeHtml(r.notes)+'</div>') : ''}
    </div>
  `).join('') : '<div class="card">No resources yet.</div>';
  document.getElementById('resourceList').innerHTML = out;
}

/* ---------- Counseling ---------- */
function sendCounsel(){
  const txt = document.getElementById('counselText').value.trim();
  if(!txt) return alert('Enter a counseling request');
  const arr = read(STORE_KEYS.counsel);
  arr.unshift({ id:uid(), text:txt, status:'pending', time:now() });
  write(STORE_KEYS.counsel, arr);
  document.getElementById('counselText').value='';
  renderCounsel();
}

function clearCounsel(){ document.getElementById('counselText').value=''; }

function resolveCounsel(id){
  const arr = read(STORE_KEYS.counsel).map(c=> c.id===id ? {...c, status:'resolved'} : c );
  write(STORE_KEYS.counsel, arr);
  renderCounsel();
}

function renderCounsel(){
  const arr = read(STORE_KEYS.counsel);
  if(!arr.length){ document.getElementById('counselList').innerHTML = '<div class="card">No counseling requests.</div>'; return; }
  document.getElementById('counselList').innerHTML = arr.map(c=>`
    <div class="list-item">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>${escapeHtml(shorten(c.text,80))}</strong><div class="muted">${new Date(c.time).toLocaleString()}</div></div>
        <div>
          <button onclick="resolveCounsel('${c.id}')">${c.status==='pending'?'Mark Resolved':'Resolved'}</button>
        </div>
      </div>
      <div style="margin-top:8px"><em>${escapeHtml(c.text)}</em></div>
      <div class="muted">Status: ${escapeHtml(c.status)}</div>
    </div>
  `).join('');
}

/* ---------- Announcements ---------- */
function postAnn(){
  const txt = document.getElementById('annText').value.trim();
  if(!txt) return alert('Enter announcement text');
  const arr = read(STORE_KEYS.announcements);
  arr.unshift({ id:uid(), text:txt, time:now() });
  write(STORE_KEYS.announcements, arr);
  document.getElementById('annText').value='';
  renderAnns();
}
function clearAnn(){ document.getElementById('annText').value=''; }
function deleteAnn(id){
  const arr = read(STORE_KEYS.announcements).filter(a=>a.id!==id);
  write(STORE_KEYS.announcements, arr);
  renderAnns();
}
function renderAnns(){
  const arr = read(STORE_KEYS.announcements);
  if(!arr.length){ document.getElementById('annList').innerHTML = '<div class="card">No announcements.</div>'; return; }
  document.getElementById('annList').innerHTML = arr.map(a=>`
    <div class="list-item">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>${escapeHtml(a.text)} <div class="muted">${new Date(a.time).toLocaleString()}</div></div>
        <div><button onclick="deleteAnn('${a.id}')" style="background:#d9534f">Delete</button></div>
      </div>
    </div>
  `).join('');
}

/* ---------- Feedback ---------- */
function sendFB(){
  const txt = document.getElementById('fbText').value.trim();
  if(!txt) return alert('Enter feedback');
  const arr = read(STORE_KEYS.feedback);
  arr.unshift({ id:uid(), text:txt, time:now(), status:'open' });
  write(STORE_KEYS.feedback, arr);
  document.getElementById('fbText').value='';
  renderFB();
}
function clearFB(){ document.getElementById('fbText').value=''; }
function closeFB(id){
  const arr = read(STORE_KEYS.feedback).map(f => f.id===id ? {...f, status:'closed'} : f );
  write(STORE_KEYS.feedback, arr);
  renderFB();
}
function renderFB(){
  const arr = read(STORE_KEYS.feedback);
  if(!arr.length){ document.getElementById('fbList').innerHTML = '<div class="card">No feedback yet.</div>'; return; }
  document.getElementById('fbList').innerHTML = arr.map(f=>`
    <div class="list-item">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>${escapeHtml(f.text)}<div class="muted">${new Date(f.time).toLocaleString()}</div></div>
        <div><button onclick="closeFB('${f.id}')">${f.status==='open'?'Close':'Closed'}</button></div>
      </div>
      <div class="muted">Status: ${escapeHtml(f.status)}</div>
    </div>
  `).join('');
}

/* ---------- Misc helpers ---------- */
function renderAll(){
  renderSummary();
  renderDoubts();
  renderResources();
  renderCounsel();
  renderAnns();
  renderFB();
}

function promptManualAnswer(doubtId){
  const ans = prompt('Type the answer/suggestion to add to this doubt:');
  if(ans && ans.trim()){
    addAnswerToDoubt(doubtId, ans.trim());
  }
}

/* Use resource content to quickly add as an answer to a doubt */
function useAsAnswer(resId){
  const res = read(STORE_KEYS.resources).find(r=>r.id===resId);
  if(!res) return;
  const doubtArr = read(STORE_KEYS.doubts);
  if(!doubtArr.length){ alert('No doubts to attach to — post a doubt first'); return; }
  // attach to the most recent doubt
  addAnswerToDoubt(doubtArr[0].id, `From resource "${res.title}":\n${res.notes || res.link || 'See resource'}`);
  alert('Resource content added as an answer to the latest doubt.');
}

/* Data export & clear */
function downloadData(){
  const data = {
    doubts: read(STORE_KEYS.doubts),
    resources: read(STORE_KEYS.resources),
    counsel: read(STORE_KEYS.counsel),
    announcements: read(STORE_KEYS.announcements),
    feedback: read(STORE_KEYS.feedback)
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'student-support-data.json'; a.click();
  URL.revokeObjectURL(url);
}

function clearAll(){
  if(!confirm('Clear all demo data stored in your browser?')) return;
  Object.values(STORE_KEYS).forEach(k=>localStorage.removeItem(k));
  renderAll();
}

/* Utilities */
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }
function escapeAttr(s){ return escapeHtml(s).replace(/"/g,'&quot;'); }
function shorten(s,n){ if(!s) return ''; return s.length>n? s.slice(0,n-1)+'…': s; }

/* ---------- Initial sample data for first-time users ---------- */
(function init(){
  // ensure keys exist
  Object.values(STORE_KEYS).forEach(k=>{ if(localStorage.getItem(k)===null) localStorage.setItem(k,'[]'); });
  // optional: add a helpful sample announcement if empty
  if(read(STORE_KEYS.announcements).length===0){
    write(STORE_KEYS.announcements, [{ id:uid(), text:'Welcome! This is a frontend-only demo. Use the left menu to explore features.', time:now() }]);
  }
  renderAll();
})();
</script>

</body>
</html>
